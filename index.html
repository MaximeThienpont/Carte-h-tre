// Créez le calque GeoJSON4, mais sans ajouter de données initiales
var geojsonLayer4 = L.geoJSON(null, {
    pointToLayer: function (feature, latlng) {
        // Vous pouvez personnaliser l'apparence des points ici
        return L.marker(latlng, {
            // Options pour les marqueurs, si nécessaire
        });
    },
    onEachFeature: function (feature, layer) {
        // Ajout du popup au marqueur
        layer.bindPopup(createPopupContent(feature));
    }
});

// Ajoutez le calque GeoJSON4 à la carte
geojsonLayer4.addTo(map);

// Fonction pour créer le contenu du popup en fonction des propriétés de la feature
function createPopupContent(feature) {
    var popupContent = "";
    // Ajoutez les propriétés au popup seulement si elles ne sont pas null ou false
    popupContent += (feature.properties.Consigne !== null && feature.properties.Consigne !== false) ? "<strong>Consigne:</strong> " + feature.properties.Consigne + "<br>" : "";
    popupContent += (feature.properties.Fil !== null && feature.properties.Fil !== false) ? "<Fil" + "<br>" : "";
    popupContent += (feature.properties.Piquet !== null && feature.properties.Piquet !== false) ? "Piquet" + "<br>" : "";
    popupContent += (feature.properties.Bout !== null && feature.properties.Bout !== false) ? "Bout" + "<br>" : "";
    popupContent += (feature.properties.Marquant !== null && feature.properties.Marquant !== false) ? "Marquant" + "<br>" : "";

    return popupContent;
}

// Ajoutez des cases à cocher pour filtrer les marqueurs
var filterControls = document.getElementById('filterControls');

// Fonction de filtrage basée sur les cases à cocher
function filterMarkers() {
    // Effacer les marqueurs actuels du calque
    geojsonLayer4.clearLayers();

    // Filtrer les données en fonction des cases à cocher
    var filteredFeatures = myGeoJSON4.features.filter(function (feature) {
        var showMarker = false;  // Initialisez à false, changez à true si au moins une condition est remplie
        ['Consigne', 'Fil', 'Piquet', 'Bout', 'Marquant'].forEach(function (property) {
            var checkbox = document.getElementById(property);
            if (checkbox.checked && (feature.properties[property] !== null && feature.properties[property] !== false)) {
                showMarker = true;
            }
        });
        return showMarker;
    });

    // Ajouter les nouvelles données filtrées au calque
    geojsonLayer4.addData({ type: 'FeatureCollection', features: filteredFeatures });
}

// Créez une case à cocher pour chaque propriété
['Consigne', 'Fil', 'Piquet', 'Bout', 'Marquant'].forEach(function (property) {
    var checkbox = document.createElement('input');
    checkbox.type = 'checkbox';
    checkbox.id = property;
    checkbox.checked = true;  // Par défaut, toutes les cases sont cochées
    checkbox.addEventListener('change', function () {
        filterMarkers();
    });

    var label = document.createElement('label');
    label.htmlFor = property;
    label.appendChild(document.createTextNode(property));

    filterControls.appendChild(checkbox);
    filterControls.appendChild(label);
    filterControls.appendChild(document.createElement('br'));
});
